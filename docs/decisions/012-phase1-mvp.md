# 012: Phase 1 MVP 定義 (Phase 1 MVP)

**ステータス**: Draft
**最終更新**: 2024-XX-XX
**担当領域**: PM / 全体

---

## 概要

MaiRust Phase 1 MVP（Minimum Viable Product）のスコープと完了基準を定義します。

---

## 1. Phase 1 の目標

```
「最小限だが実用的なメールプラットフォームを提供する」
```

### 1.1 提供価値

- SMTP でメールを受信・保存できる
- REST API でメールを取得・管理できる
- Web UI でメールを閲覧・管理できる
- Hook でプラグインを呼び出せる
- 基本的なスパム検出ができる

### 1.2 Non-Goals（Phase 1 では対象外）

- IMAP / POP サポート
- Marketplace 連携
- 複雑な AI 機能
- 水平スケーリング
- UI Plugin

---

## 2. 機能スコープ

### 2.1 Core (SMTP)

| 機能 | 状態 |
|------|------|
| SMTP 受信（port 25） | ✅ 必須 |
| SMTP Submission（port 587） | ✅ 必須 |
| STARTTLS | ✅ 必須 |
| SMTP AUTH (PLAIN/LOGIN) | ✅ 必須 |
| メッセージキュー | ✅ 必須 |
| 基本的なルーティング | ✅ 必須 |
| SPF 検証 | ✅ 必須 |
| DKIM 署名 | ✅ 必須 |
| DMARC 検証 | ⚠️ 基本のみ |

### 2.2 Storage

| 機能 | 状態 |
|------|------|
| PostgreSQL サポート | ✅ 必須 |
| SQLite サポート | ✅ 必須 |
| ローカル FS ストレージ | ✅ 必須 |
| S3 ストレージ | ⚠️ 基本のみ |
| フルテキスト検索 | ❌ Phase 2 |

### 2.3 API

| 機能 | 状態 |
|------|------|
| 認証（API Key / セッション） | ✅ 必須 |
| ユーザー CRUD | ✅ 必須 |
| ドメイン CRUD | ✅ 必須 |
| メッセージ一覧・詳細 | ✅ 必須 |
| メッセージ検索（基本） | ✅ 必須 |
| メール送信 | ✅ 必須 |
| タグ・フラグ操作 | ✅ 必須 |
| Hook 管理 | ✅ 必須 |
| プラグイン管理（ローカル） | ✅ 必須 |
| OpenAPI ドキュメント | ✅ 必須 |

### 2.4 Web Admin UI

| 機能 | 状態 |
|------|------|
| ログイン・ログアウト | ✅ 必須 |
| ダッシュボード（基本統計） | ✅ 必須 |
| ユーザー管理 | ✅ 必須 |
| ドメイン管理 | ✅ 必須 |
| メール一覧・閲覧 | ✅ 必須 |
| Hook 管理 | ✅ 必須 |
| プラグイン管理 | ✅ 必須 |
| 設定画面 | ⚠️ 基本のみ |

### 2.5 Hook / Plugin

| 機能 | 状態 |
|------|------|
| `post_receive` Hook | ✅ 必須 |
| `pre_receive` Hook | ⚠️ 基本のみ |
| `pre_send` Hook | ⚠️ 基本のみ |
| HTTP プラグイン連携 | ✅ 必須 |
| プラグイン認証（HMAC） | ✅ 必須 |
| Circuit Breaker | ✅ 必須 |
| ローカルプラグインインストール | ✅ 必須 |
| Marketplace 連携 | ❌ Phase 2 |

### 2.6 スパム対策

| 機能 | 状態 |
|------|------|
| rspamd 連携 | ✅ 必須 |
| 基本ルールベースフィルタ | ✅ 必須 |
| AI スパム判定 | ❌ Phase 2 |
| 送信レート制限 | ⚠️ 基本のみ |
| Outbound Policy Engine | ❌ Phase 2 |

### 2.7 監視・運用

| 機能 | 状態 |
|------|------|
| Prometheus メトリクス | ✅ 必須 |
| 構造化ログ（JSON） | ✅ 必須 |
| ヘルスチェック | ✅ 必須 |
| 基本的な監査ログ | ✅ 必須 |

### 2.8 デプロイ

| 機能 | 状態 |
|------|------|
| Docker イメージ（all-in-one） | ✅ 必須 |
| docker-compose サンプル | ✅ 必須 |
| 基本的な設定ファイル | ✅ 必須 |
| Helm Chart | ❌ Phase 2 |
| Kubernetes Operator | ❌ Phase 4 |

---

## 3. 技術要件

### 3.1 パフォーマンス

| 指標 | 目標 |
|------|------|
| メッセージ受信 | 50+ msg/sec（単一ノード） |
| API レスポンス | < 200ms (p95) |
| メール本文取得 | < 500ms (p95) |

### 3.2 スケール

| 指標 | 目標 |
|------|------|
| ユーザー数 | 〜1,000 |
| メールボックス数 | 〜10,000 |
| 保存メッセージ数 | 〜100万 |

### 3.3 可用性

| 指標 | 目標 |
|------|------|
| 可用性 | 99%（単一ノード） |
| 計画外停止 | < 7時間/月 |

---

## 4. 完了基準（Definition of Done）

### 4.1 機能

- [ ] 全 ✅ 必須機能が実装されている
- [ ] 全 ⚠️ 基本機能が最小限実装されている
- [ ] API が OpenAPI 仕様に従っている
- [ ] Web UI から基本操作が可能

### 4.2 品質

- [ ] ユニットテストカバレッジ > 60%
- [ ] 結合テスト（E2E）が通過
- [ ] 静的解析（Clippy / ESLint）警告なし
- [ ] セキュリティスキャン（基本的な脆弱性なし）

### 4.3 ドキュメント

- [ ] README（クイックスタート）
- [ ] インストールガイド
- [ ] API リファレンス（OpenAPI）
- [ ] 設定リファレンス
- [ ] プラグイン開発ガイド（基本）

### 4.4 運用

- [ ] Docker イメージが Docker Hub で公開
- [ ] `docker run` で起動可能
- [ ] 基本的なバックアップ・リストア手順

---

## 5. サンプルプラグイン

Phase 1 で提供するサンプルプラグイン：

| プラグイン | 説明 |
|-----------|------|
| `mairust-plugin-echo` | 受信メールをログ出力（テスト用） |
| `mairust-plugin-rspamd` | rspamd 連携スパムフィルタ |
| `mairust-plugin-webhook` | 外部 URL への Webhook 通知 |

---

## 6. マイルストーン（例）

### M1: Core SMTP

- SMTP 受信・送信
- PostgreSQL 保存
- 基本認証

### M2: API & Web UI

- REST API 実装
- Web UI 基本画面

### M3: Hook & Plugin

- Hook Manager
- プラグイン連携
- rspamd 連携

### M4: Polish & Release

- テスト・品質改善
- ドキュメント
- Docker イメージ公開

---

## 7. Phase 2 以降への申し送り

### Phase 2 で対応予定

- Meilisearch 連携（フルテキスト検索）
- Marketplace 連携
- IMAP（read-only）
- 送信スパム対策（Outbound Policy Engine）
- 詳細なマルチテナント機能

### Phase 3 で対応予定

- IMAP（フル機能）
- AI 分類・要約プラグイン
- UI Plugin
- 高度なポリシーエンジン

### Phase 4 で対応予定

- Kubernetes Operator
- SaaS コントロールプレーン
- 水平スケーリング

---

## 8. リスク

| リスク | 影響 | 対策 |
|--------|------|------|
| SMTP 実装の複雑さ | 遅延 | 既存ライブラリ活用、スコープ限定 |
| rspamd 連携の問題 | 機能制限 | フォールバックルール実装 |
| パフォーマンス未達 | 品質 | 早期ベンチマーク、最適化優先度設定 |

---

## 9. 成功指標

| 指標 | 目標 |
|------|------|
| GitHub Star | 100+ |
| Docker Pull | 500+ |
| コントリビューター | 5+ |
| ドキュメントされた Issue | 対応率 80%+ |

---

## 関連ドキュメント

- [001-foundation.md](./001-foundation.md) - 基本方針
- [../roadmap.md](../roadmap.md) - 全体ロードマップ
